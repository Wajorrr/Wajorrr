var e=Object.defineProperty,t=(t,r,s)=>(((t,r,s)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s})(t,"symbol"!=typeof r?r+"":r,s),s);import{d as r,m as s,o as a,q as n}from"./index.00355e4b.js";var i=(e=>(e.version="1.0.0",e))(i||{});const o=e=>{const t=history[e];return function(){const r=t.apply(this,arguments);var s=new Event(e);return window.dispatchEvent(s),r}},c=["click","dblclick","contextmenu","mousedown","mouseup","mouseenter","mouseout","mouseover"];class h{constructor(e){t(this,"data"),t(this,"version"),this.data=Object.assign(this.initDef(),e),this.installInnerTrack()}initDef(){return this.version=i.version,window.history.pushState=o("pushState"),window.history.replaceState=o("replaceState"),{sdkVersion:this.version,historyTracker:!1,hashTracker:!1,domTracker:!1,jsError:!1}}setUserId(e){this.data.uuid=e}setExtra(e){this.data.extra=e}sendTracker(e){this.reportTracker(e)}captureEvents(e,t,r){e.forEach((e=>{window.addEventListener(e,(()=>{this.reportTracker({event:e,targetKey:t,data:r})}))}))}installInnerTrack(){this.data.historyTracker&&(this.captureEvents(["pushState"],"history-pv"),this.captureEvents(["replaceState"],"history-pv"),this.captureEvents(["popstate"],"history-pv")),this.data.hashTracker&&this.captureEvents(["hashchange"],"hash-pv"),this.data.domTracker&&this.targetKeyReport(),this.data.jsError&&this.jsError()}targetKeyReport(){c.forEach((e=>{window.addEventListener(e,(t=>{const r=t.target.getAttribute("target-key");r&&this.sendTracker({targetKey:r,event:e})}))}))}jsError(){this.errorEvent(),this.promiseReject()}errorEvent(){window.addEventListener("error",(e=>{this.sendTracker({targetKey:"message",event:"error",message:e.message})}))}promiseReject(){window.addEventListener("unhandledrejection",(e=>{e.promise.catch((e=>{this.sendTracker({targetKey:"reject",event:"promise",message:e})}))}))}reportTracker(e){const t=Object.assign(this.data,e,{time:(new Date).getTime()});let r=new Blob([JSON.stringify(t)],{type:"application/x-www-form-urlencoded"});navigator.sendBeacon(this.data.requestUrl,r)}}const d=[n("button",{"target-key":"btn"},"添加了target-key属性的按钮",-1),n("br",null,null,-1),n("button",null,"无添加按钮",-1)],p=r({setup:e=>(new h({requestUrl:"http://localhost:3333/tracker",hashTracker:!0,historyTracker:!0,domTracker:!0,jsError:!0}),(e,t)=>(a(),s("div",null,d)))});export{p as default};
